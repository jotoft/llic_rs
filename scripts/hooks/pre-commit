#!/bin/bash
# Pre-commit hook: runs tests if Rust files have changed

set -e

# Check if any Rust files are staged
RUST_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(rs|toml)$' || true)

if [ -z "$RUST_FILES" ]; then
    echo "No Rust files changed, skipping checks."
    exit 0
fi

echo "Rust files changed, running checks..."

# Run rustfmt check
echo "Checking formatting..."
cargo fmt --all -- --check

# Run clippy
echo "Running clippy..."
cargo clippy --all-targets -- -D warnings

# Run tests
echo "Running tests..."
cargo test --release

echo "All checks passed!"