<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLIC WASM Demo</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="main-layout">
    <div class="main-content">
      <h1>LLIC WASM Compression Demo</h1>

      <div class="view-toggle">
        <button class="view-btn active" data-view="side-by-side">Side by Side</button>
        <button class="view-btn" data-view="compare">Compare</button>
      </div>

      <div class="image-container" id="sideBySideView">
        <div class="panel">
          <h3>Original (Grayscale)</h3>
          <canvas id="originalCanvas"></canvas>
        </div>
        <div class="panel">
          <h3 id="outputLabel">LLIC Lossless</h3>
          <canvas id="decompressedCanvas"></canvas>
        </div>
      </div>

      <div class="compare-container" id="compareView" style="display:none;">
        <div class="compare-wrapper" id="compareWrapper">
          <canvas id="compareCanvas"></canvas>
          <div class="compare-slider" id="compareSlider">
            <div class="compare-line"></div>
            <div class="compare-handle"></div>
          </div>
          <div class="compare-labels">
            <span class="compare-label-left">Original</span>
            <span class="compare-label-right">LLIC Lossless</span>
          </div>
        </div>
      </div>

      <p class="subtitle">Lossless grayscale compression. High-frequency noise/texture is harder to compress; smooth gradients compress well.<br>
        <em style="color: #555; font-size: 0.85em;">Note: Demo images are WebP-compressed. Use raw/uncompressed images for accurate compression testing.</em></p>
    </div>

    <div class="sidebar-stack">
      <div class="sidebar-box">
        <h3>Image</h3>
        <div class="image-select">
          <button class="demo-btn" data-image="demo_image2.webp">Rattan Weave</button>
          <button class="demo-btn" data-image="demo_image.webp">Rock Formation</button>
        </div>
        <div class="drop-zone" id="dropZone">
          <span>Drop file or click to browse</span>
          <input type="file" id="fileInput" accept="image/*" hidden>
        </div>
      </div>

      <div class="sidebar-box">
        <h3>Quality</h3>
        <div class="radio-group" style="margin-top: 0; padding-top: 0; border-top: none;">
          <label class="radio-label">
            <input type="radio" name="quality" value="lossless" checked>
            <span>Lossless</span>
          </label>
          <label class="radio-label">
            <input type="radio" name="quality" value="very_high">
            <span>Very High (±2)</span>
          </label>
          <label class="radio-label">
            <input type="radio" name="quality" value="high">
            <span>High (±4)</span>
          </label>
          <label class="radio-label">
            <input type="radio" name="quality" value="medium">
            <span>Medium (±8)</span>
          </label>
          <label class="radio-label">
            <input type="radio" name="quality" value="low">
            <span>Low (±16)</span>
          </label>
        </div>
      </div>

      <div class="sidebar-box">
        <h3>Pre-filters</h3>
        <div class="sidebar-control">
          <label>Blur</label>
          <div class="slider-row">
            <input type="range" id="blurSlider" min="0" max="10" step="0.5" value="0">
            <span id="blurValue">0</span>
          </div>
        </div>
      </div>

      <div class="sidebar-box">
        <h3>Debug Overlay</h3>
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" id="showDecompressed" checked>
            <span>Show Base Image</span>
          </label>
        </div>
        <div class="radio-group">
          <label class="radio-label">
            <input type="radio" name="debugOverlay" value="none" checked>
            <span>None</span>
          </label>
          <label class="radio-label">
            <input type="radio" name="debugOverlay" value="residual">
            <span>Lossless Prediction Residual</span>
          </label>
          <label class="radio-label">
            <input type="radio" name="debugOverlay" value="error">
            <span>Reconstruction Error</span>
          </label>
        </div>
        <div class="hover-info" id="hoverInfo">
          <span class="hover-label">Hover over image</span>
        </div>
      </div>

      <div class="sidebar-box" id="stats">
        <h3>Compression Stats</h3>
        <div class="stats-grid">
          <div class="stat-row"><span class="stat-label">Version</span><span class="stat-value" id="version">...</span></div>
          <div class="stat-row"><span class="stat-label">Size</span><span class="stat-value" id="imageSize">-</span></div>
          <div class="stat-row"><span class="stat-label">Original</span><span class="stat-value" id="originalSize">-</span></div>
          <div class="stat-row"><span class="stat-label">Compressed</span><span class="stat-value" id="compressedSize">-</span></div>
          <div class="stat-row"><span class="stat-label">Ratio</span><span class="stat-value" id="ratio">-</span></div>
          <div class="stat-row"><span class="stat-label">Compress</span><span class="stat-value" id="compressTime">-</span></div>
          <div class="stat-row"><span class="stat-label">Decompress</span><span class="stat-value" id="decompressTime">-</span></div>
          <div class="stat-row"><span class="stat-label">Throughput</span><span class="stat-value" id="throughput">-</span></div>
          <div class="stat-row"><span class="stat-label">Similarity</span><span class="stat-value" id="similarity">-</span></div>
        </div>
        <button id="benchBtn" class="bench-btn">Benchmark</button>
        <div id="benchResults" class="bench-results"></div>
      </div>
    </div>
  </div>

  <script type="module" src="./main.js"></script>

  <footer style="text-align: center; padding: 2rem 1rem; margin-top: 2rem; border-top: 1px solid #333; color: #888; font-size: 0.85em;">
    <a href="https://github.com/jotoft/llic_rs" style="color: #aaa;">llic_rs</a> · Based on <a href="https://gitlab.com/llic/llic" style="color: #aaa;">LLIC</a> by Peter Rundberg
  </footer>
</body>
</html>
